<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Records</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script
  src="https://code.jquery.com/jquery-3.7.1.js"
  integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
  crossorigin="anonymous"></script>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body class="p-4">

  <div class="container">
    <h2>Student Records</h2>

    <div class="d-flex justify-content-between mb-3">
      <input type="text" class="form-control w-50" id="search" placeholder="Search by name">
      <div>
        <button class="btn btn-success" data-toggle="modal" data-target="#addStudentModal">Add Student</button>
        <button class="btn btn-primary" onclick="fetchData()">Refresh</button>
      </div>
    </div>

    <table class="table table-bordered text-center">
      <thead class="table-dark">
        <tr>
          <th>Profile</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Gender</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="tbody">
      
      </tbody>
    </table>
  </div>

  <!-- ✅ Add Student Modal -->
  <div class="modal fade" id="addStudentModal" tabindex="-1" aria-labelledby="addStudentLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">Add New Student</h5>
          <button class="btn-close" data-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <form id="addStudentForm" enctype="multipart/form-data">
            <input type="text" class="form-control mb-2" placeholder="First Name" name="firstName" required>
            <input type="text" class="form-control mb-2" placeholder="Last Name" name="lastName" required>
            <input type="email" class="form-control mb-2" placeholder="Email" name="email" required>
            <input type="text" class="form-control mb-2" placeholder="Phone" name="phone" required>
            <select class="form-select mb-2" name="gender" required>
              <option selected disabled>Select Gender</option>
              <option>Male</option>
              <option>Female</option>
            </select>
            <label class="form-label">Upload Profile Picture:</label>
            <input type="file" class="form-control" name="profilePic" required>
          </form>
        </div>

        <div class="modal-footer">
          <button type="submit" form="addStudentForm" class="btn btn-success">Create Student</button>
        </div>

      </div>
    </div>
  </div>

  <!-- ✅ Edit Student Modal (Same Inputs) -->
  <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">Edit Student</h5>
          <button class="btn-close" data-dismiss="modal" aria-label="Close"></button>
        </div>
        

        <div class="modal-body">
          <form id="editStudentForm" enctype="multipart/form-data">
            <input type="text" class="form-control mb-2" placeholder="First Name" name="firstName" required>
            <input type="text" class="form-control mb-2" placeholder="Last Name" name="lastName" required>
            <input type="email" class="form-control mb-2" placeholder="Email" name="email" required>
            <input type="text" class="form-control mb-2" placeholder="Phone" name="phone" required>
            <select class="form-select mb-2" name="gender" required>
              <option selected disabled>Select Gender</option>
              <option>Male</option>
              <option>Female</option>
            </select>
            <label class="form-label">Upload Profile Picture:</label>
            <input type="file" class="form-control" name="profilePic">
          </form>
        </div>

        <div class="modal-footer">
          <button type="submit" form="editStudentForm" class="btn btn-warning">Update Student</button>
        </div>

      </div>
    </div>
  </div>


<!-- Modal -->
<!-- Button trigger modal -->


<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Student Details</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body m-b">
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        
      </div>
    </div>
  </div>
</div>
<script>
  async function fetchData(search = "") {
    try {
    const apiURL = `http://localhost:3000/api/users?search=${encodeURIComponent(search)}`;
    const res  = await fetch(apiURL)
    const data = await res.json();
    console.log(data);
    if(data){
      $("tbody").empty();
    data.forEach(element => {
      $("tbody").append(
      
  `
    <tr>
          <td><img class="rounded-circle"  src=${element.profile_pic.startsWith("http")
      ? element.profile_pic
      : "./uploads/" + element.profile_pic
    }  width="40" height="40" /></td>
          <td>${element.first_name}</td>
          <td>${element.last_name}</td>
          <td>${element.email}</td>
          <td>${element.phone}</td>
          <td>${element.gender}</td>
          <td>
            <button class="btn btn-info btn-sm" data-toggle="modal" data-target="#exampleModalCenter" onclick="viwStudent('${element._id}')">View</button>
            <button class="btn btn-warning btn-sm" data-toggle="modal" data-target="#editStudentModal" >Edit</button>
            <button class="btn btn-danger btn-sm" onclick="deleteStudent('${element._id}')">Delete</button>
          </td>
        </tr>
  `        
      );
    });
    }
    
  } catch (error) {
    console.log(error.message);
    
  }
}
async function  viwStudent(params) {
  const apiURL = `http://localhost:3000/api/users/${params}`;
  try {
      const res  = await fetch(apiURL)
    let data = await res.json();
    console.log(data);
    if(data){
      $('.m-b').empty();
      $('.m-b').append(
        `
          <div>
         <img class="rounded"  src=${data.profile_pic.startsWith("http")
      ? data.profile_pic
      : "./uploads/" + data.profile_pic
    }  width="100" height="100" /></br></br>
      <p><b>Name:</b>${data.first_name + data.last_name}</p>
      <p><b>Email:</b>${data.email }</p>
      <p><b>Phone:</b>${data.phone }</p>
      <p><b>Gender:</b>${data.gender }</p>
        </div>

        `
        
      );
    }

  } catch (error) {
    console.log(error.message);
    
  }
}
$('#search').on("input", function () {
  fetchData($(this).val());
  console.log($(this).val());
  
});

fetchData()
</script> 
  <!-- Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script></body>
</html>
